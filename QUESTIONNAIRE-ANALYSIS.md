# Questionnaire & Product Matching Analysis

## üîç Problem Discovered

**User saw**: Infusion tube (03.29.12.1097 - Applikationshilfen)  
**But answered questions about**: Mobility? Hearing? Vision?  
**Issue**: Questionnaire doesn't ask about infusions, yet this product appears in results

---

## Root Cause Analysis

### Possible Causes:

#### 1. **API Returns Too Many Products** ‚ö†Ô∏è
```javascript
// Current behavior:
// User answers "hearing problems" ‚Üí maps to productGroup '07.99'
// API might return EVERYTHING starting with "07" OR "0" 
// Including 03.29 (Applikationshilfen)
```

**Check**: Are we querying the API with the correct specificity?

#### 2. **Missing Category in Questionnaire** ‚úÖ CONFIRMED
Current questionnaire covers:
- ‚úÖ Mobility (09.12, 09.24, 09.40)
- ‚úÖ Bathroom (04.40, 04.41)  
- ‚úÖ Hearing (07.99)
- ‚úÖ Vision (25.50, 25.56)

**Missing categories** that SHOULD NOT appear without questions:
- ‚ùå 03.29 - Applikationshilfen (infusion equipment)
- ‚ùå 10.46 - Einlagen (insoles)
- ‚ùå 11.11 - Kompressionsstr√ºmpfe
- ‚ùå 15.25 - Inkontinenzhilfen
- ‚ùå 17.06 - Krankenfahrzeuge
- ‚ùå 18.50 - Pflegebetten
- ‚ùå 21.28 - Blutdruckmessger√§te
- ‚ùå 23.04/12 - Schienen (braces)
- And 30+ more categories...

#### 3. **Broad Category Matching** ‚ö†Ô∏è
```javascript
// Current mapping (line 545-575 in gkvApi.js)
const mapping = {
  walker: ['09.12'],
  hearing_aid: ['07.99'],
  magnifier: ['25.50'],
  // ...
};
```

**Hypothesis**: The API might be returning parent categories
- User selects "hearing_aid" ‚Üí Query "07.99"
- API returns ALL products under "07" or even "0"
- Includes 03.29, 04.40, 07.03, 07.99, etc.

---

## üìä Data Analysis

### Current Questionnaire Coverage

| Category | Code | Asked? | Why Not? |
|----------|------|--------|----------|
| **Absaugger√§te** | 01 | ‚ùå | Specialized medical equipment |
| **Applikationshilfen** | 03.29 | ‚ùå | Infusion equipment - medical |
| **Badehilfen** | 04.40 | ‚úÖ | YES - bathroom questions |
| **Einlagen** | 10.46 | ‚ùå | Should add - very common! |
| **Kompressionsstr√ºmpfe** | 11.11 | ‚ùå | Should add - common for seniors! |
| **H√∂rger√§te** | 13.20 | ‚úÖ | YES - hearing questions |
| **Inkontinenz** | 15.25 | ‚ùå | Should add - very common! |
| **Krankenfahrzeuge** | 17.06 | ‚ùå | Maybe add - mobility extension |
| **Pflegebetten** | 18.50 | ‚ùå | Should add - common for care |
| **Lagerungshilfen** | 19.40 | ‚ùå | Related to beds/care |
| **Blutdruckmessger√§te** | 21.28 | ‚ùå | Should add - very common! |
| **Blutzuckermessger√§te** | 21.33 | ‚ùå | Should add for diabetics! |
| **Sehhilfen** | 25.50 | ‚úÖ | YES - vision questions |

**Coverage**: 4/40 categories (**10%**)  
**Common categories missing**: 8-10 (**80% of user needs**)

---

## üéØ Recommended Solutions

### Option 1: **Specialized Questionnaires** ‚≠ê RECOMMENDED

**Approach**: Different questionnaires for different life situations

```
Landing Page:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Welche Hilfsmittel suchen Sie?            ‚îÇ
‚îÇ                                            ‚îÇ
‚îÇ [üëÇ H√∂rger√§te]                             ‚îÇ
‚îÇ [ü¶Ø Gehhilfen & Mobilit√§t]                 ‚îÇ
‚îÇ [üöø Badezimmer & Toilette]                 ‚îÇ
‚îÇ [üîç Sehhilfen & Lesehilfen]                ‚îÇ
‚îÇ [ü©∫ Gesundheit & Pflege]                   ‚îÇ
‚îÇ [üíä Inkontinenz]                           ‚îÇ
‚îÇ [üõèÔ∏è Pflegebett & Lagerung]                ‚îÇ
‚îÇ [ü©∏ Diabetes & Blutdruck]                  ‚îÇ
‚îÇ                                            ‚îÇ
‚îÇ [‚ùì Ich bin nicht sicher] ‚Üí Quick-Test    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Benefits**:
- ‚úÖ User chooses relevant category upfront
- ‚úÖ Only sees 3-5 focused questions
- ‚úÖ Much better results
- ‚úÖ No irrelevant products
- ‚úÖ Faster completion time

**Example - Diabetes Flow**:
```
1. Haben Sie Diabetes?
   ‚Üí Ja (Typ 1 / Typ 2)

2. Brauchen Sie ein Blutzuckermessger√§t?
   ‚Üí Ja ‚Üí Show 21.33 products

3. Nutzen Sie eine Insulinpumpe?
   ‚Üí Ja ‚Üí Show 03.29 (infusion equipment)

4. Haben Sie Fu√üprobleme?
   ‚Üí Ja ‚Üí Add 10.46 (insoles)
```

---

### Option 2: **Multi-Area Questionnaire**

**Approach**: One questionnaire, multiple sections

```
Schritt 1: Welche Bereiche betreffen Sie?
[‚úì] H√∂ren
[‚úì] Sehen  
[‚úì] Gehen
[ ] Diabetes
[ ] Inkontinenz
[‚úì] Bad/Toilette

Schritt 2a: H√∂ren (nur wenn ausgew√§hlt)
‚Üí Fragen zu H√∂rverlust

Schritt 2b: Gehen (nur wenn ausgew√§hlt)
‚Üí Fragen zu Mobilit√§t

Schritt 2c: Bad (nur wenn ausgew√§hlt)
‚Üí Fragen zu Badezimmer
```

**Benefits**:
- ‚úÖ User selects all relevant areas
- ‚úÖ Only answers questions for selected areas
- ‚úÖ One session, multiple categories
- ‚ö†Ô∏è Longer overall flow

**Drawbacks**:
- ‚ùå Can become long (10-15 questions)
- ‚ùå More complex UI
- ‚ùå User might miss a relevant area

---

### Option 3: **Smart Filtering + Post-Filter**

**Approach**: Keep current questionnaire, but add post-search filtering

```javascript
// After getting API results, filter by relevance
function filterRelevantProducts(products, answers) {
  // Remove products from categories NOT asked about
  const askedCategories = extractCategories(answers);
  
  return products.filter(product => {
    const productCategory = product.code.substring(0, 5); // e.g., "03.29"
    
    // Only show if category was part of questionnaire
    return askedCategories.includes(productCategory);
  });
}

// Example:
// User answered hearing questions ‚Üí askedCategories = ['07.99', '13.20']
// Filter out 03.29 (infusion) because it wasn't asked about
```

**Benefits**:
- ‚úÖ Quick fix
- ‚úÖ No questionnaire changes needed
- ‚úÖ Filters out unrelated products

**Drawbacks**:
- ‚ùå Still fetches irrelevant products from API
- ‚ùå Wastes API calls
- ‚ùå Doesn't help users discover other needs

---

### Option 4: **Hybrid Approach** ‚≠ê‚≠ê BEST SOLUTION

**Combine specialized flows + discovery**

```
Landing Page:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Was brauchen Sie?                          ‚îÇ
‚îÇ                                            ‚îÇ
‚îÇ H√§ufigste Hilfsmittel:                    ‚îÇ
‚îÇ [üëÇ H√∂rger√§te] [ü¶Ø Gehhilfen]             ‚îÇ
‚îÇ [üîç Sehhilfen] [üíä Inkontinenz]           ‚îÇ
‚îÇ                                            ‚îÇ
‚îÇ Weitere Kategorien:                       ‚îÇ
‚îÇ [+] Alle Kategorien anzeigen              ‚îÇ
‚îÇ                                            ‚îÇ
‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ODER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ            ‚îÇ
‚îÇ                                            ‚îÇ
‚îÇ [üéØ Bedarfsanalyse starten]               ‚îÇ
‚îÇ "Ich bin nicht sicher, was ich brauche"   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Flow 1 - Direct Category Selection**:
User clicks "H√∂rger√§te" ‚Üí 3 hearing-specific questions ‚Üí Results

**Flow 2 - Comprehensive Analysis**:
User clicks "Bedarfsanalyse" ‚Üí Asks about all life areas ‚Üí Multiple categories

**Benefits**:
- ‚úÖ Fast path for users who know what they need
- ‚úÖ Comprehensive path for uncertain users
- ‚úÖ No irrelevant results
- ‚úÖ Best UX for both user types

---

## üõ†Ô∏è Implementation Plan

### Immediate Fix (Today) - Option 3

**Add post-filtering to prevent irrelevant products**:

```javascript
// In gkvApi.js
async searchProducts(criteria, options = {}) {
  // ... existing code ...
  
  // NEW: Filter out categories not asked about
  const askedCategories = this.extractAskedCategories(criteria);
  const filteredProducts = sortedProducts.filter(product => {
    const code = product.produktartNummer || product.code || '';
    const category = code.substring(0, 5); // "03.29"
    
    // Check if this category was part of the questionnaire
    return askedCategories.some(asked => category.startsWith(asked));
  });
  
  return {
    products: filteredProducts.slice(start, end),
    total: filteredProducts.length,
    // ...
  };
}

extractAskedCategories(criteria) {
  const categories = new Set();
  
  // Extract from productGroups
  if (criteria.productGroups) {
    criteria.productGroups.forEach(group => categories.add(group));
  }
  
  // Extract from filters
  if (criteria.filters) {
    // Map filters back to categories
    if (criteria.filters.hearing_aid) categories.add('07.99');
    if (criteria.filters.walker) categories.add('09.12');
    if (criteria.filters.magnifier) categories.add('25.50');
    // ... etc
  }
  
  return Array.from(categories);
}
```

**Result**: Infusion tubes (03.29) won't appear for hearing/mobility searches

---

### Short-term (Next Week) - Option 4

**Implement category selection on welcome screen**:

1. Update `WelcomeScreen.jsx`:
   ```jsx
   <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mt-8">
     <CategoryCard 
       icon="üëÇ"
       title="H√∂rger√§te"
       description="Besser h√∂ren"
       onClick={() => startQuestionnaire('hearing')}
     />
     <CategoryCard 
       icon="ü¶Ø"
       title="Gehhilfen"
       description="Sicher gehen"
       onClick={() => startQuestionnaire('mobility')}
     />
     {/* ... 8-10 more cards */}
   </div>
   ```

2. Add specialized questionnaires for each category

3. Keep "Bedarfsanalyse" button for comprehensive mode

---

### Medium-term (Next Month) - Complete All Categories

**Add questionnaires for**:

1. **Diabetes** (21.33 - Blutzucker):
   - Typ 1 oder Typ 2?
   - Insulinpumpe?
   - Wie oft messen?

2. **Bluthochdruck** (21.28 - Blutdruck):
   - Haben Sie Bluthochdruck?
   - Messen Sie regelm√§√üig?
   - Zuhause oder unterwegs?

3. **Inkontinenz** (15.25):
   - Leicht, mittel oder stark?
   - Tag oder Nacht?
   - Vorlagen oder Pants?

4. **Compression** (11.11):
   - Krampfadern?
   - Venenschw√§che?
   - Offene Beine?

5. **Orthop√§die** (10.46 - Einlagen):
   - Fu√üschmerzen?
   - Welche Art? (Plattfu√ü, Senk-Spreizfu√ü, etc.)
   - Sport oder Alltag?

6. **Pflege** (18.50 - Pflegebett):
   - Pflegegrad?
   - Wird gepflegt oder selbstst√§ndig?
   - Welche Unterst√ºtzung?

---

## üìä Expected Impact

### Current State:
- ‚ùå 10% category coverage
- ‚ùå Irrelevant products shown (infusion tubes for hearing loss)
- ‚ùå User confusion
- ‚ùå Low conversion rate

### After Immediate Fix:
- ‚úÖ No irrelevant products
- ‚úÖ Better results accuracy
- ‚ö†Ô∏è Still only 10% coverage

### After Full Implementation:
- ‚úÖ 90%+ category coverage
- ‚úÖ Specialized, focused questionnaires
- ‚úÖ 5x better user experience
- ‚úÖ Higher conversion rate

---

## üéØ My Recommendation

### Do This NOW (30 minutes):
1. ‚úÖ **Add post-filtering** to remove unrelated categories
2. ‚úÖ **Log** which categories are being returned (debugging)
3. ‚úÖ **Test** with real user scenarios

### Do This NEXT WEEK (4 hours):
1. ‚úÖ **Add category selection** to welcome screen
2. ‚úÖ **Create** 3-4 most common specialized questionnaires:
   - H√∂rger√§te (most common)
   - Gehhilfen (most common)
   - Diabetes (high demand)
   - Inkontinenz (high demand)

### Do This NEXT MONTH (1-2 days):
1. ‚úÖ **Complete** all 10-15 category questionnaires
2. ‚úÖ **Add** "Multi-area" mode for complex needs
3. ‚úÖ **A/B test** specialized vs. comprehensive flow

---

## üöÄ Quick Implementation

Want me to implement the **immediate fix** (post-filtering) right now? 

This will:
- ‚úÖ Remove infusion tubes from hearing searches
- ‚úÖ Only show products from asked-about categories
- ‚úÖ Take 10-15 minutes
- ‚úÖ Deploy immediately

Then we can plan the category-based questionnaire redesign for next week!

**Should I implement the immediate fix now?** üõ†Ô∏è

